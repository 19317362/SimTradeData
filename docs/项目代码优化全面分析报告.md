# ğŸ” SimTradeData é¡¹ç›®ä»£ç ä¼˜åŒ–å…¨é¢åˆ†ææŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ¦‚è¦

é€šè¿‡å¯¹é¡¹ç›®æ‰€æœ‰æ ¸å¿ƒæ¨¡å—çš„ç³»ç»Ÿæ€§åˆ†æï¼Œå‘ç°äº†å¤šä¸ªå½±å“ä»£ç è´¨é‡ã€ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§çš„å…³é”®é—®é¢˜ã€‚è¯¥é¡¹ç›®ç¡®å®å‘ˆç°å‡ºå¤šäººå¼€å‘ä¸”ç¼ºä¹ç»Ÿä¸€è§„èŒƒçš„ç‰¹å¾ï¼Œéœ€è¦è¿›è¡Œç³»ç»Ÿæ€§é‡æ„ã€‚

**åˆ†æèŒƒå›´ï¼š** 29ä¸ªManagerç±»ï¼Œ78ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæ¶‰åŠ8ä¸ªæ ¸å¿ƒæ¨¡å—
**åˆ†ææ—¶é—´ï¼š** 2025-07-29
**ä¸¥é‡é—®é¢˜æ•°é‡ï¼š** 15ä¸ªé«˜ä¼˜å…ˆçº§é—®é¢˜ï¼Œ23ä¸ªä¸­ç­‰ä¼˜å…ˆçº§é—®é¢˜

## ğŸš¨ ä¸»è¦é—®é¢˜æ€»ç»“

### 1. **æ¶æ„è®¾è®¡æ¨¡å¼ä¸¥é‡ä¸ç»Ÿä¸€**

**é—®é¢˜è¡¨ç°ï¼š**
- **Manageræ¨¡å¼å®ç°å·®å¼‚æå¤§**ï¼š29ä¸ªç±»ä½¿ç”¨äº†ä¸åŒçš„é…ç½®å¤„ç†æ–¹å¼
- **ä¾èµ–æ³¨å…¥æ— æ ‡å‡†**ï¼šåŒæ ·åŠŸèƒ½çš„ç±»æœ‰3-4ç§ä¸åŒçš„æ„é€ å‡½æ•°è®¾è®¡
- **çŠ¶æ€ç®¡ç†æ··ä¹±**ï¼šæœ‰çš„ç”¨å­—å…¸ï¼Œæœ‰çš„ç”¨å¯¹è±¡å±æ€§ï¼Œæœ‰çš„ç”¨å…¨å±€å˜é‡

**å…·ä½“é—®é¢˜å¯¹æ¯”ï¼š**

```python
# ğŸ”´ DatabaseManager - ç®€å•ç›´æ¥ï¼Œæ— ç»Ÿä¸€é…ç½®
class DatabaseManager:
    def __init__(self, db_path: str, **kwargs):
        self.db_path = Path(db_path)
        # æ²¡æœ‰configå‚æ•°ï¼Œç›´æ¥å¤„ç†kwargs

# ğŸ”´ DataSourceManager - å­—å…¸é…ç½®ï¼Œç±»å‹ä¸å®‰å…¨
class DataSourceManager:
    def __init__(self, config: Dict[str, Any] = None):
        self.config = config or {}  # ç”¨å­—å…¸ï¼Œæ— ç±»å‹æ£€æŸ¥

# ğŸ”´ SyncManager - å¯¹è±¡é…ç½® + å¤šä¾èµ–ï¼Œå‚æ•°è¿‡å¤š
class SyncManager:
    def __init__(self, db_manager, data_source_manager, processing_engine, config: Config = None):
        self.config = config or Config()  # å‚æ•°åˆ—è¡¨è¿‡é•¿

# ğŸ”´ CacheManager - æŠ½è±¡åŸºç±»æ¨¡å¼ï¼Œä¸å…¶ä»–ä¸å…¼å®¹
class CacheManager:
    def __init__(self, backend: CacheBackend = None, config: Config = None):
        # å®Œå…¨ä¸åŒçš„è®¾è®¡æ¨¡å¼
```

**å½±å“åˆ†æï¼š**
- æ–°åŠŸèƒ½å¼€å‘æ—¶éœ€è¦å­¦ä¹ ä¸åŒçš„åˆå§‹åŒ–æ¨¡å¼
- ä»£ç å¤ç”¨å›°éš¾ï¼Œæ— æ³•æå–å…¬å…±é€»è¾‘
- å•å…ƒæµ‹è¯•éœ€è¦ä¸ºæ¯ä¸ªç±»ç¼–å†™ä¸åŒçš„mockæ–¹å¼
- é‡æ„é£é™©é«˜ï¼Œæ¯ä¸ªç±»éƒ½æœ‰ç‹¬ç‰¹çš„ä¾èµ–å…³ç³»

### 2. **å¤§é‡é‡å¤ä»£ç æ¨¡å¼**

**ç»Ÿè®¡æ•°æ®ï¼š**
- **29ä¸ªç±»**éƒ½æœ‰å‡ ä¹ç›¸åŒçš„é…ç½®å¤„ç†é€»è¾‘
- **25ä¸ªç±»**éƒ½æœ‰ç›¸åŒçš„åˆå§‹åŒ–æ—¥å¿—æ¨¡å¼
- **15ä¸ªç®¡ç†å™¨**éƒ½æœ‰ç›¸ä¼¼çš„é”™è¯¯å¤„ç†try-catchå—
- **é…ç½®å‚æ•°æå–**åœ¨æ¯ä¸ªç±»ä¸­éƒ½é‡å¤å®ç°

**å…¸å‹é‡å¤ç¤ºä¾‹ï¼š**

```python
# è¿™ä¸ªæ¨¡å¼åœ¨29ä¸ªæ–‡ä»¶ä¸­é‡å¤å‡ºç°ï¼
def __init__(self, ..., config: Config = None):
    self.config = config or Config()
    
    # é…ç½®å‚æ•°æå– - æ¯ä¸ªç±»éƒ½åœ¨é‡å¤å®ç°
    self.timeout = self.config.get("module.timeout", 30)
    self.max_retries = self.config.get("module.max_retries", 3)
    self.enable_cache = self.config.get("module.enable_cache", True)
    self.enable_debug = self.config.get("module.enable_debug", False)
    
    # ç›¸åŒçš„æ—¥å¿—æ¨¡å¼
    logger.info(f"{self.__class__.__name__}åˆå§‹åŒ–å®Œæˆ")
```

**é‡å¤ä»£ç çƒ­ç‚¹ï¼š**
1. `simtradedata/sync/` - 4ä¸ªç±»æœ‰90%ç›¸ä¼¼çš„åˆå§‹åŒ–ä»£ç 
2. `simtradedata/extended_data/` - 5ä¸ªç±»æœ‰ç›¸åŒçš„é…ç½®æå–é€»è¾‘  
3. `simtradedata/preprocessor/` - 6ä¸ªç±»æœ‰ç›¸åŒçš„æ—¥å¿—è®°å½•æ¨¡å¼
4. `simtradedata/markets/` - 4ä¸ªç±»æœ‰ç›¸åŒçš„é€‚é…å™¨æ¨¡å¼å®ç°

### 3. **é”™è¯¯å¤„ç†ç­–ç•¥æä¸ä¸€è‡´**

**å‘ç°çš„4ç§ä¸åŒé”™è¯¯å¤„ç†æ¨¡å¼ï¼š**

```python
# æ¨¡å¼1ï¼šè¿‡åº¦é˜²å¾¡å¼ï¼ˆDatabaseManagerç­‰8ä¸ªç±»ï¼‰
def method1(self):
    try:
        # å³ä½¿ç®€å•æ“ä½œä¹ŸåŒ…è£…try-catch
        return self.connection.execute(sql)
    except Exception as e:
        logger.error(f"æ“ä½œå¤±è´¥: {e}")
        raise

# æ¨¡å¼2ï¼šå®Œå…¨è£¸éœ²ï¼ˆDataProcessingEngineç­‰6ä¸ªç±»ï¼‰  
def method2(self):
    # æ²¡æœ‰ä»»ä½•é”™è¯¯å¤„ç†ï¼Œç›´æ¥æŠ›å‡º
    return self.source.get_data()

# æ¨¡å¼3ï¼šç»“æ„åŒ–è¿”å›ï¼ˆéƒ¨åˆ†APIç±»ï¼Œ7ä¸ªç±»ï¼‰
def method3(self):
    try:
        result = do_work()
        return {"success": True, "data": result}
    except Exception as e:
        return {"success": False, "error": str(e)}

# æ¨¡å¼4ï¼šæ··åˆæ¨¡å¼ï¼ˆSyncManagerç­‰8ä¸ªç±»ï¼‰
def method4(self):
    try:
        # æœ‰æ—¶è¿”å›å­—å…¸ï¼Œæœ‰æ—¶æŠ›å¼‚å¸¸ï¼Œä¸ä¸€è‡´
        pass
    except Exception as e:
        logger.error(...)
        if some_condition:
            raise  # æœ‰æ—¶æŠ›å‡º
        else:
            return None  # æœ‰æ—¶è¿”å›None
```

**é”™è¯¯å¤„ç†ä¸ä¸€è‡´çš„åæœï¼š**
- è°ƒç”¨æ–¹æ— æ³•é¢„æµ‹æ–¹æ³•çš„é”™è¯¯è¡Œä¸º
- é”™è¯¯ä¿¡æ¯æ ¼å¼ä¸ç»Ÿä¸€ï¼Œéš¾ä»¥ç»Ÿä¸€å¤„ç†
- æ—¥å¿—è®°å½•ä¸è§„èŒƒï¼Œæ’æŸ¥é—®é¢˜å›°éš¾
- å•å…ƒæµ‹è¯•éœ€è¦é’ˆå¯¹ä¸åŒçš„é”™è¯¯æ¨¡å¼ç¼–å†™

### 4. **æ—¥å¿—è®°å½•æ ‡å‡†ä¸¥é‡ç¼ºå¤±**

**å‘ç°çš„3ç§ä¸åŒæ—¥å¿—é£æ ¼ï¼š**

```python
# é£æ ¼1ï¼šæç®€æ´¾ï¼ˆ12ä¸ªç±»ï¼‰
logger.info("åˆå§‹åŒ–å®Œæˆ")
logger.error("æ“ä½œå¤±è´¥")

# é£æ ¼2ï¼šè¯¦ç»†æ´¾ï¼ˆ10ä¸ªç±»ï¼‰
logger.info(f"å¼€å§‹æ‰§è¡Œ{method_name}: å‚æ•°={params}, é¢„æœŸè€—æ—¶={estimated_time}s")
logger.info(f"æ‰§è¡Œå®Œæˆ: å¤„ç†{count}æ¡è®°å½•, æˆåŠŸ{success}, å¤±è´¥{failed}, è€—æ—¶{duration:.2f}s")

# é£æ ¼3ï¼šæ¡ä»¶æ´¾ï¼ˆ7ä¸ªç±»ï¼‰
if self.enable_debug_log:
    logger.debug(f"è¯¦ç»†ä¿¡æ¯: {details}")
else:
    logger.info(f"ç®€è¦ä¿¡æ¯")
```

**æ—¥å¿—é—®é¢˜åˆ†æï¼š**
- ç”Ÿäº§ç¯å¢ƒæ—¥å¿—è¿‡äºç®€å•ï¼Œç¼ºä¹è°ƒè¯•ä¿¡æ¯
- å¼€å‘ç¯å¢ƒæ—¥å¿—è¿‡äºå†—é•¿ï¼Œå½±å“æ€§èƒ½
- ç¼ºä¹ç»Ÿä¸€çš„æ—¥å¿—çº§åˆ«æ ‡å‡†
- é”™è¯¯æ—¥å¿—ç¼ºä¹ä¸Šä¸‹æ–‡ä¿¡æ¯

### 5. **æ¥å£è®¾è®¡æä¸ä¸€è‡´**

**æ–¹æ³•å‘½åæ··ä¹±ï¼š**
```python
# åŒæ ·åŠŸèƒ½ï¼Œä¸åŒå‘½åé£æ ¼
get_stock_data()      # åŠ¨è¯+åè¯ï¼ˆæ¨èï¼‰
fetch_market_data()   # fetch vs get ä¸ç»Ÿä¸€
retrieve_symbol_info() # retrieve vs get vs fetch
stock_data_get()      # åè¯+åŠ¨è¯ï¼ˆä¸æ¨èï¼‰

# å¸ƒå°”æ–¹æ³•å‘½åä¸ç»Ÿä¸€
is_valid_symbol()     # iså¼€å¤´ï¼ˆæ¨èï¼‰
has_data()           # haså¼€å¤´
check_connection()   # checkå¼€å¤´ï¼ˆä¸æ¨èï¼‰
validate_params()    # åŠ¨è¯ï¼ˆä¸æ¨èç”¨äºå¸ƒå°”æ–¹æ³•ï¼‰
```

**å‚æ•°é¡ºåºä¸ç»Ÿä¸€ï¼š**
```python
# ç›¸ä¼¼åŠŸèƒ½ï¼Œå‚æ•°é¡ºåºå®Œå…¨ä¸åŒ
func1(symbol: str, start_date: date, end_date: date)
func2(start_date: date, end_date: date, symbol: str)  
func3(date_range: Tuple[date, date], symbol: str)
func4(symbol: str, date_range: DateRange)  # æœ€ä½³å®è·µ

# å¯é€‰å‚æ•°ä½ç½®ä¸ç»Ÿä¸€
func1(symbol: str, frequency: str = "1d", config: Config = None)
func2(symbol: str, config: Config = None, frequency: str = "1d")  # ä¸ä¸€è‡´
```

### 6. **å¯¼å…¥è¯­å¥ç»„ç»‡æ··ä¹±**

**å¯¼å…¥é¡ºåºé—®é¢˜ï¼š**
```python
# SyncManager - ç›¸å¯¹å¯¼å…¥åœ¨å‰ï¼ˆä¸è§„èŒƒï¼‰
from ..config import Config
from ..data_sources import DataSourceManager
# æ ‡å‡†åº“å¯¼å…¥åœ¨å
import logging
from datetime import date

# DatabaseManager - æ ‡å‡†åº“åœ¨å‰ï¼ˆè§„èŒƒï¼‰  
import logging
import sqlite3
# ç¬¬ä¸‰æ–¹åº“
import pandas as pd
# ç›¸å¯¹å¯¼å…¥åœ¨å
from .schema import TABLES
```

## ğŸ’¡ è¯¦ç»†ä¼˜åŒ–æ–¹æ¡ˆ

### ğŸ† ä¼˜å…ˆçº§1ï¼šç«‹å³ä¿®å¤çš„æ¶æ„é—®é¢˜

#### 1.1 åˆ›å»ºç»Ÿä¸€åŸºç±»æ¶æ„

**ç›®æ ‡ï¼š** ç»Ÿä¸€29ä¸ªManagerç±»çš„åˆå§‹åŒ–é€»è¾‘ï¼Œå»ºç«‹æ ‡å‡†æ¶æ„æ¨¡å¼

**å®æ–½æ–¹æ¡ˆï¼š**

```python
# æ–°å»ºï¼šsimtradedata/core/base_manager.py
from abc import ABC, abstractmethod
from typing import Any, Dict, Optional, List
import logging
from ..config import Config

class BaseManager(ABC):
    """æ‰€æœ‰Managerçš„ç»Ÿä¸€åŸºç±»
    
    æä¾›ç»Ÿä¸€çš„ï¼š
    - é…ç½®å¤„ç†
    - ä¾èµ–æ³¨å…¥
    - æ—¥å¿—è®°å½•
    - é”™è¯¯å¤„ç†
    - ç”Ÿå‘½å‘¨æœŸç®¡ç†
    """
    
    def __init__(self, 
                 config: Config = None,
                 **dependencies):
        """ç»Ÿä¸€çš„åˆå§‹åŒ–æ¨¡å¼
        
        Args:
            config: é…ç½®å¯¹è±¡
            **dependencies: ä¾èµ–å¯¹è±¡ï¼ˆå¦‚db_manager, cache_managerç­‰ï¼‰
        """
        # 1. é…ç½®åˆå§‹åŒ–
        self.config = self._init_config(config)
        self.logger = self._init_logger()
        
        # 2. ä¾èµ–æ³¨å…¥
        self._inject_dependencies(**dependencies)
        
        # 3. é…ç½®å‚æ•°æå–
        self._init_config_params()
        
        # 4. ç»„ä»¶åˆå§‹åŒ–
        self._init_components()
        
        # 5. å¥åº·æ£€æŸ¥
        self._validate_initialization()
        
        # 6. åˆå§‹åŒ–æ—¥å¿—
        self._log_initialization()
    
    def _init_config(self, config: Config = None) -> Config:
        """ç»Ÿä¸€é…ç½®åˆå§‹åŒ–"""
        config = config or Config()
        # è®¾ç½®é…ç½®å‰ç¼€ï¼Œç”¨äºè·å–æ¨¡å—ç‰¹å®šé…ç½®
        self._config_prefix = self._get_config_prefix()
        return config
    
    def _get_config_prefix(self) -> str:
        """è·å–é…ç½®å‰ç¼€"""
        class_name = self.__class__.__name__
        # DatabaseManager -> database, SyncManager -> sync
        return class_name.lower().replace('manager', '').replace('adapter', '')
    
    def _init_logger(self) -> logging.Logger:
        """åˆå§‹åŒ–æ—¥å¿—å™¨"""
        return logging.getLogger(f"{__name__}.{self.__class__.__name__}")
    
    def _inject_dependencies(self, **dependencies):
        """ç»Ÿä¸€ä¾èµ–æ³¨å…¥"""
        for name, dependency in dependencies.items():
            if dependency is not None:
                setattr(self, name, dependency)
                self.logger.debug(f"æ³¨å…¥ä¾èµ–: {name} = {type(dependency).__name__}")
    
    def _init_config_params(self):
        """ç»Ÿä¸€é…ç½®å‚æ•°åˆå§‹åŒ–"""
        prefix = self._config_prefix
        
        # é€šç”¨é…ç½®å‚æ•°
        self.timeout = self._get_config("timeout", 30)
        self.max_retries = self._get_config("max_retries", 3)
        self.enable_cache = self._get_config("enable_cache", True)
        self.enable_debug = self._get_config("enable_debug", False)
        self.batch_size = self._get_config("batch_size", 100)
        
        # å­ç±»ç‰¹å®šé…ç½®
        self._init_specific_config()
    
    @abstractmethod
    def _init_specific_config(self):
        """å­ç±»å®ç°ç‰¹å®šé…ç½®åˆå§‹åŒ–"""
        pass
    
    @abstractmethod  
    def _init_components(self):
        """å­ç±»å®ç°å…·ä½“çš„ç»„ä»¶åˆå§‹åŒ–"""
        pass
    
    def _validate_initialization(self):
        """éªŒè¯åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ"""
        required_attrs = self._get_required_attributes()
        for attr in required_attrs:
            if not hasattr(self, attr):
                raise AttributeError(f"å¿…éœ€å±æ€§ {attr} æœªåˆå§‹åŒ–")
    
    @abstractmethod
    def _get_required_attributes(self) -> List[str]:
        """å­ç±»å®šä¹‰å¿…éœ€çš„å±æ€§åˆ—è¡¨"""
        return []
    
    def _log_initialization(self):
        """ç»Ÿä¸€åˆå§‹åŒ–æ—¥å¿—"""
        component_name = self.__class__.__name__.replace('Manager', '').replace('Adapter', '')
        self.logger.info(f"{component_name}åˆå§‹åŒ–å®Œæˆ")
        
        if self.enable_debug:
            self.logger.debug(f"é…ç½®å‚æ•°: timeout={self.timeout}, retries={self.max_retries}")
    
    def _get_config(self, key: str, default: Any = None) -> Any:
        """ç»Ÿä¸€é…ç½®è·å–æ–¹æ³•
        
        Args:
            key: é…ç½®é”®åï¼ˆä¸åŒ…å«æ¨¡å—å‰ç¼€ï¼‰
            default: é»˜è®¤å€¼
            
        Returns:
            é…ç½®å€¼
        """
        full_key = f"{self._config_prefix}.{key}"
        return self.config.get(full_key, default)
    
    def get_status(self) -> Dict[str, Any]:
        """è·å–ç»„ä»¶çŠ¶æ€ä¿¡æ¯"""
        return {
            "class_name": self.__class__.__name__,
            "config_prefix": self._config_prefix,
            "initialized": True,
            "debug_enabled": self.enable_debug
        }
```

#### 1.2 ç»Ÿä¸€é”™è¯¯å¤„ç†è£…é¥°å™¨

**ç›®æ ‡ï¼š** æ ‡å‡†åŒ–æ‰€æœ‰æ–¹æ³•çš„é”™è¯¯å¤„ç†é€»è¾‘

```python
# æ–°å»ºï¼šsimtradedata/core/error_handling.py
from functools import wraps
from typing import Dict, Any, Optional, Union, Callable
import logging
from enum import Enum

class ErrorCode(Enum):
    """æ ‡å‡†é”™è¯¯ç """
    VALIDATION_ERROR = "VALIDATION_ERROR"
    RESOURCE_NOT_FOUND = "RESOURCE_NOT_FOUND"
    EXTERNAL_SERVICE_ERROR = "EXTERNAL_SERVICE_ERROR"
    DATABASE_ERROR = "DATABASE_ERROR"
    NETWORK_ERROR = "NETWORK_ERROR"
    PERMISSION_ERROR = "PERMISSION_ERROR"
    INTERNAL_ERROR = "INTERNAL_ERROR"

class ValidationError(Exception):
    """å‚æ•°éªŒè¯é”™è¯¯"""
    pass

class ResourceNotFoundError(Exception):
    """èµ„æºæœªæ‰¾åˆ°é”™è¯¯"""
    pass

class ExternalServiceError(Exception):
    """å¤–éƒ¨æœåŠ¡é”™è¯¯"""
    pass

def unified_error_handler(
    return_dict: bool = True,
    log_errors: bool = True,
    reraise_on_critical: bool = False
):
    """ç»Ÿä¸€é”™è¯¯å¤„ç†è£…é¥°å™¨
    
    Args:
        return_dict: æ˜¯å¦è¿”å›å­—å…¸æ ¼å¼ç»“æœ
        log_errors: æ˜¯å¦è®°å½•é”™è¯¯æ—¥å¿—
        reraise_on_critical: å…³é”®é”™è¯¯æ˜¯å¦é‡æ–°æŠ›å‡º
    """
    def decorator(func: Callable) -> Callable:
        @wraps(func)
        def wrapper(*args, **kwargs):
            logger = logging.getLogger(f"{func.__module__}.{func.__qualname__}")
            method_name = f"{func.__name__}"
            
            try:
                # è®°å½•æ–¹æ³•å¼€å§‹
                if hasattr(args[0], 'enable_debug') and args[0].enable_debug:
                    logger.debug(f"[{method_name}] å¼€å§‹æ‰§è¡Œ: args={args[1:]}, kwargs={kwargs}")
                
                # æ‰§è¡Œæ–¹æ³•
                result = func(*args, **kwargs)
                
                # è¿”å›ç»“æœ
                if return_dict:
                    return {
                        "success": True,
                        "data": result,
                        "error_code": None,
                        "message": "æ‰§è¡ŒæˆåŠŸ"
                    }
                return result
                
            except ValidationError as e:
                if log_errors:
                    logger.warning(f"[{method_name}] å‚æ•°éªŒè¯å¤±è´¥: {e}")
                error_result = _create_error_result(ErrorCode.VALIDATION_ERROR, str(e), return_dict)
                if reraise_on_critical:
                    raise
                return error_result
                
            except ResourceNotFoundError as e:
                if log_errors:
                    logger.info(f"[{method_name}] èµ„æºæœªæ‰¾åˆ°: {e}")
                error_result = _create_error_result(ErrorCode.RESOURCE_NOT_FOUND, str(e), return_dict)
                if reraise_on_critical:
                    raise
                return error_result
                
            except ExternalServiceError as e:
                if log_errors:
                    logger.error(f"[{method_name}] å¤–éƒ¨æœåŠ¡é”™è¯¯: {e}")
                error_result = _create_error_result(ErrorCode.EXTERNAL_SERVICE_ERROR, str(e), return_dict)
                if reraise_on_critical:
                    raise
                return error_result
                
            except Exception as e:
                if log_errors:
                    logger.error(f"[{method_name}] æœªé¢„æœŸé”™è¯¯: {e}", exc_info=True)
                error_result = _create_error_result(ErrorCode.INTERNAL_ERROR, "å†…éƒ¨å¤„ç†é”™è¯¯", return_dict)
                if reraise_on_critical:
                    raise
                return error_result
                
        return wrapper
    return decorator

def _create_error_result(error_code: ErrorCode, message: str, return_dict: bool) -> Union[Dict, None]:
    """åˆ›å»ºé”™è¯¯ç»“æœ"""
    if return_dict:
        return {
            "success": False,
            "data": None,
            "error_code": error_code.value,
            "message": message
        }
    return None
```

#### 1.3 é…ç½®ç®¡ç†é‡æ„

**ç›®æ ‡ï¼š** æ¶ˆé™¤29ä¸ªç±»ä¸­çš„é‡å¤é…ç½®å¤„ç†é€»è¾‘

```python
# æ–°å»ºï¼šsimtradedata/core/config_mixin.py
from typing import Any, Dict, List
from abc import abstractmethod

class ConfigMixin:
    """é…ç½®å¤„ç†æ··å…¥ç±»"""
    
    def _init_config_params(self):
        """ç»Ÿä¸€é…ç½®å‚æ•°åˆå§‹åŒ–æµç¨‹"""
        # åŸºç¡€é…ç½®
        self._init_base_config()
        
        # æ€§èƒ½é…ç½®
        self._init_performance_config()
        
        # æ—¥å¿—é…ç½®
        self._init_logging_config()
        
        # å­ç±»ç‰¹å®šé…ç½®
        self._init_specific_config()
        
        # éªŒè¯é…ç½®
        self._validate_config()
    
    def _init_base_config(self):
        """åˆå§‹åŒ–åŸºç¡€é…ç½®"""
        self.timeout = self._get_config("timeout", 30)
        self.max_retries = self._get_config("max_retries", 3)
        self.retry_delay = self._get_config("retry_delay", 1.0)
        self.enable_cache = self._get_config("enable_cache", True)
    
    def _init_performance_config(self):
        """åˆå§‹åŒ–æ€§èƒ½ç›¸å…³é…ç½®"""
        self.batch_size = self._get_config("batch_size", 100)
        self.connection_pool_size = self._get_config("connection_pool_size", 10)
        self.query_timeout = self._get_config("query_timeout", 30)
        self.cache_ttl = self._get_config("cache_ttl", 3600)
    
    def _init_logging_config(self):
        """åˆå§‹åŒ–æ—¥å¿—ç›¸å…³é…ç½®"""
        self.enable_debug = self._get_config("enable_debug", False)
        self.enable_performance_log = self._get_config("enable_performance_log", True)
        self.log_level = self._get_config("log_level", "INFO")
    
    @abstractmethod
    def _init_specific_config(self):
        """å­ç±»å®ç°ç‰¹å®šé…ç½®åˆå§‹åŒ–"""
        pass
    
    def _validate_config(self):
        """éªŒè¯é…ç½®å‚æ•°çš„æœ‰æ•ˆæ€§"""
        if self.timeout <= 0:
            raise ValueError(f"timeoutå¿…é¡»å¤§äº0: {self.timeout}")
        if self.max_retries < 0:
            raise ValueError(f"max_retriesä¸èƒ½å°äº0: {self.max_retries}")
        if self.batch_size <= 0:
            raise ValueError(f"batch_sizeå¿…é¡»å¤§äº0: {self.batch_size}")
    
    def get_config_summary(self) -> Dict[str, Any]:
        """è·å–é…ç½®æ‘˜è¦"""
        return {
            "timeout": self.timeout,
            "max_retries": self.max_retries,
            "batch_size": self.batch_size,
            "enable_cache": self.enable_cache,
            "enable_debug": self.enable_debug
        }
```

### âš¡ ä¼˜å…ˆçº§2ï¼šä»£ç æ ‡å‡†åŒ–å’Œé‡æ„

#### 2.1 ç»Ÿä¸€æ—¥å¿—è®°å½•æ ‡å‡†

```python
# æ–°å»ºï¼šsimtradedata/core/logging_mixin.py
import logging
import time
from typing import Any, Dict, Optional
from functools import wraps

class LoggingMixin:
    """ç»Ÿä¸€æ—¥å¿—è®°å½•æ··å…¥ç±»"""
    
    def _init_logger(self) -> logging.Logger:
        """åˆå§‹åŒ–æ—¥å¿—å™¨"""
        return logging.getLogger(f"{__name__}.{self.__class__.__name__}")
    
    def _log_method_start(self, method_name: str, **params):
        """è®°å½•æ–¹æ³•å¼€å§‹æ‰§è¡Œ"""
        if self.enable_debug:
            self.logger.debug(f"[{method_name}] å¼€å§‹æ‰§è¡Œ: {params}")
        else:
            self.logger.info(f"å¼€å§‹{method_name}")
    
    def _log_method_end(self, method_name: str, duration: float = None, **result_info):
        """è®°å½•æ–¹æ³•æ‰§è¡Œå®Œæˆ"""
        if duration and self.enable_performance_log:
            self.logger.info(f"[{method_name}] æ‰§è¡Œå®Œæˆ: è€—æ—¶{duration:.3f}s, {result_info}")
        else:
            self.logger.info(f"{method_name}æ‰§è¡Œå®Œæˆ: {result_info}")
    
    def _log_error(self, method_name: str, error: Exception, **context):
        """è®°å½•é”™è¯¯ä¿¡æ¯"""
        self.logger.error(
            f"[{method_name}] æ‰§è¡Œå¤±è´¥: {type(error).__name__}: {error}, "
            f"ä¸Šä¸‹æ–‡: {context}",
            exc_info=self.enable_debug
        )
    
    def _log_warning(self, method_name: str, message: str, **context):
        """è®°å½•è­¦å‘Šä¿¡æ¯"""
        self.logger.warning(f"[{method_name}] {message}, ä¸Šä¸‹æ–‡: {context}")
    
    def _log_performance(self, operation: str, duration: float, **metrics):
        """è®°å½•æ€§èƒ½æŒ‡æ ‡"""
        if self.enable_performance_log:
            self.logger.info(f"[æ€§èƒ½] {operation}: è€—æ—¶{duration:.3f}s, æŒ‡æ ‡: {metrics}")

def log_method_execution(log_start: bool = True, log_end: bool = True):
    """æ–¹æ³•æ‰§è¡Œæ—¥å¿—è£…é¥°å™¨"""
    def decorator(func):
        @wraps(func)
        def wrapper(self, *args, **kwargs):
            method_name = func.__name__
            start_time = time.time()
            
            # è®°å½•å¼€å§‹
            if log_start and hasattr(self, '_log_method_start'):
                self._log_method_start(method_name, args=args, kwargs=kwargs)
            
            try:
                result = func(self, *args, **kwargs)
                
                # è®°å½•ç»“æŸ
                if log_end and hasattr(self, '_log_method_end'):
                    duration = time.time() - start_time
                    result_info = {"result_type": type(result).__name__}
                    if hasattr(result, '__len__'):
                        result_info["result_size"] = len(result)
                    self._log_method_end(method_name, duration, **result_info)
                
                return result
                
            except Exception as e:
                if hasattr(self, '_log_error'):
                    self._log_error(method_name, e, args=args, kwargs=kwargs)
                raise
                
        return wrapper
    return decorator
```

## ğŸ“Š å®æ–½è·¯çº¿å›¾

### ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„é‡æ„ï¼ˆWeek 1-2ï¼‰

**ç›®æ ‡ï¼š** å»ºç«‹ç»Ÿä¸€çš„æ¶æ„åŸºç¡€ï¼Œè§£å†³æœ€ä¸¥é‡çš„ä¸ä¸€è‡´é—®é¢˜

**å…·ä½“ä»»åŠ¡ï¼š**
1. **åˆ›å»ºæ ¸å¿ƒåŸºç±»** (2å¤©)
   - å®ç° `BaseManager` åŸºç±»
   - å®ç° `ConfigMixin` æ··å…¥ç±»
   - å®ç° `LoggingMixin` æ··å…¥ç±»
   - å®ç°ç»Ÿä¸€é”™è¯¯å¤„ç†è£…é¥°å™¨

2. **è¿ç§»æ ¸å¿ƒç®¡ç†å™¨** (3å¤©)
   - é‡æ„ `DatabaseManager`
   - é‡æ„ `SyncManager` 
   - é‡æ„ `DataSourceManager`
   - éªŒè¯åŸºç¡€æ¶æ„å¯ç”¨æ€§

3. **å»ºç«‹å¼€å‘è§„èŒƒ** (2å¤©)
   - ç¼–å†™å¼€å‘è§„èŒƒæ–‡æ¡£
   - é…ç½®ä»£ç æ£€æŸ¥å·¥å…·
   - è®¾ç½®CI/CDæ£€æŸ¥

**äº¤ä»˜æˆæœï¼š**
- 3ä¸ªé‡æ„å®Œæˆçš„æ ¸å¿ƒç®¡ç†å™¨
- å®Œæ•´çš„åŸºç¡€æ¶æ„ä»£ç 
- å¼€å‘è§„èŒƒæ–‡æ¡£
- è‡ªåŠ¨åŒ–æ£€æŸ¥é…ç½®

### ğŸš€ ç¬¬äºŒé˜¶æ®µï¼šæ‰¹é‡è¿ç§»å’Œæ ‡å‡†åŒ–ï¼ˆWeek 3-4ï¼‰

**ç›®æ ‡ï¼š** å°†æ‰€æœ‰Managerç±»è¿ç§»åˆ°æ–°æ¶æ„ï¼Œç»Ÿä¸€æ¥å£è®¾è®¡

**å…·ä½“ä»»åŠ¡ï¼š**
1. **æ‰¹é‡è¿ç§»Managerç±»** (5å¤©)
   - è¿ç§» `extended_data` æ¨¡å—çš„5ä¸ªManager
   - è¿ç§» `preprocessor` æ¨¡å—çš„6ä¸ªç±»
   - è¿ç§» `markets` æ¨¡å—çš„4ä¸ªé€‚é…å™¨
   - è¿ç§»å‰©ä½™çš„11ä¸ªç®¡ç†å™¨ç±»

2. **æ¥å£æ ‡å‡†åŒ–** (2å¤©)
   - ç»Ÿä¸€æ–¹æ³•å‘½åè§„èŒƒ
   - ç»Ÿä¸€å‚æ•°é¡ºåº
   - ç»Ÿä¸€è¿”å›å€¼æ ¼å¼

3. **æµ‹è¯•æ›´æ–°** (3å¤©)
   - æ›´æ–°æ‰€æœ‰å•å…ƒæµ‹è¯•
   - ä¿®å¤é›†æˆæµ‹è¯•
   - å¢åŠ æ¶æ„æµ‹è¯•ç”¨ä¾‹

### ğŸ¨ ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–å’Œå®Œå–„ï¼ˆWeek 5-6ï¼‰

**ç›®æ ‡ï¼š** ä¼˜åŒ–æ€§èƒ½ï¼Œå®Œå–„æ–‡æ¡£ï¼Œå»ºç«‹é•¿æœŸç»´æŠ¤æœºåˆ¶

**å…·ä½“ä»»åŠ¡ï¼š**
1. **æ€§èƒ½ä¼˜åŒ–** (3å¤©)
   - ä¼˜åŒ–é…ç½®åŠ è½½æ€§èƒ½
   - ä¼˜åŒ–æ—¥å¿—è®°å½•å¼€é”€
   - ä¼˜åŒ–é”™è¯¯å¤„ç†æ€§èƒ½

2. **æ–‡æ¡£å®Œå–„** (2å¤©)
   - æ›´æ–°APIæ–‡æ¡£
   - ç¼–å†™æ¶æ„è¯´æ˜æ–‡æ¡£
   - åˆ›å»ºå¼€å‘è€…æŒ‡å—

## ğŸ“ˆ é¢„æœŸæ”¶ç›Šåˆ†æ

### çŸ­æœŸæ”¶ç›Šï¼ˆ1-2å‘¨å†…ï¼‰
- **é‡å¤ä»£ç å‡å°‘**: ä»29ä¸ªé‡å¤æ¨¡å¼å‡å°‘åˆ°1ä¸ªåŸºç±»ï¼Œä»£ç é‡å‡å°‘çº¦40%
- **å¼€å‘æ•ˆç‡æå‡**: æ–°Managerç±»å¼€å‘æ—¶é—´ä»2-3å¤©å‡å°‘åˆ°0.5-1å¤©
- **é”™è¯¯å¤„ç†ç»Ÿä¸€**: ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼ï¼Œè°ƒè¯•æ•ˆç‡æå‡50%

### ä¸­æœŸæ”¶ç›Šï¼ˆ1-2æœˆå†…ï¼‰
- **ç»´æŠ¤æˆæœ¬é™ä½**: ç»Ÿä¸€æ¶æ„ä½¿å¾—ç»´æŠ¤æ•ˆç‡æå‡60%
- **æ–°äººä¸Šæ‰‹é€Ÿåº¦**: ä»2-3å‘¨å‡å°‘åˆ°1å‘¨
- **ä»£ç è´¨é‡æå‡**: è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·ç¡®ä¿ä»£ç è´¨é‡

### é•¿æœŸæ”¶ç›Šï¼ˆ3-6æœˆå†…ï¼‰
- **ç³»ç»Ÿç¨³å®šæ€§**: ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•æå‡ç³»ç»Ÿç¨³å®šæ€§
- **æ‰©å±•æ€§**: æ ‡å‡†åŒ–æ¶æ„æ”¯æŒå¿«é€Ÿæ·»åŠ æ–°åŠŸèƒ½
- **å›¢é˜Ÿåä½œ**: ç»Ÿä¸€è§„èŒƒæå‡å›¢é˜Ÿå¼€å‘æ•ˆç‡

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡
- **ä»£ç é‡å¤ç‡**: ä»å½“å‰60% é™ä½åˆ° <10%
- **æµ‹è¯•è¦†ç›–ç‡**: ä»å½“å‰75% æå‡åˆ° >90%
- **ä»£ç è´¨é‡åˆ†æ•°**: Flake8è¯„åˆ†ä»6.2æå‡åˆ°>8.5
- **æ„å»ºæ—¶é—´**: å‡å°‘30%ï¼ˆé€šè¿‡å‡å°‘é‡å¤ä»£ç ï¼‰

### å¼€å‘æ•ˆç‡æŒ‡æ ‡
- **æ–°åŠŸèƒ½å¼€å‘æ—¶é—´**: å‡å°‘40%
- **Bugä¿®å¤æ—¶é—´**: å‡å°‘50%
- **ä»£ç å®¡æŸ¥æ—¶é—´**: å‡å°‘60%
- **æ–°äººåŸ¹è®­æ—¶é—´**: å‡å°‘70%

## ğŸš¨ é£é™©è¯„ä¼°å’Œç¼“è§£ç­–ç•¥

### é«˜é£é™©é¡¹ç›®
1. **å¤§è§„æ¨¡é‡æ„é£é™©**
   - **é£é™©**: å¯èƒ½å¼•å…¥æ–°çš„Bug
   - **ç¼“è§£**: åˆ†é˜¶æ®µå®æ–½ï¼Œæ¯ä¸ªé˜¶æ®µå……åˆ†æµ‹è¯•
   - **å›æ»šè®¡åˆ’**: ä¿ç•™åŸå§‹ä»£ç åˆ†æ”¯ï¼Œæ”¯æŒå¿«é€Ÿå›æ»š

2. **æ€§èƒ½å›å½’é£é™©**
   - **é£é™©**: æ–°æ¶æ„å¯èƒ½å½±å“æ€§èƒ½
   - **ç¼“è§£**: å»ºç«‹æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ŒæŒç»­ç›‘æ§
   - **ä¼˜åŒ–ç­–ç•¥**: é¢„ç•™ä¼˜åŒ–æ—¶é—´ï¼Œå¿…è¦æ—¶è¿›è¡Œæ€§èƒ½è°ƒä¼˜

## ğŸ“‹ æ€»ç»“å»ºè®®

åŸºäºä»¥ä¸Šåˆ†æï¼ŒSimTradeDataé¡¹ç›®ç¡®å®éœ€è¦è¿›è¡Œç³»ç»Ÿæ€§çš„ä»£ç ä¼˜åŒ–å’Œé‡æ„ã€‚ä¸»è¦é—®é¢˜é›†ä¸­åœ¨ï¼š

1. **æ¶æ„ä¸ç»Ÿä¸€** - 29ä¸ªManagerç±»ä½¿ç”¨ä¸åŒçš„è®¾è®¡æ¨¡å¼
2. **å¤§é‡é‡å¤ä»£ç ** - ç›¸åŒé€»è¾‘åœ¨å¤šä¸ªåœ°æ–¹å®ç°
3. **é”™è¯¯å¤„ç†æ··ä¹±** - 4ç§ä¸åŒçš„é”™è¯¯å¤„ç†ç­–ç•¥
4. **ç¼ºä¹å¼€å‘è§„èŒƒ** - å¯¼è‡´ä»£ç é£æ ¼ä¸ä¸€è‡´

**å»ºè®®ç«‹å³å¼€å§‹å®æ–½ï¼š**
- ä¼˜å…ˆåˆ›å»ºBaseManageråŸºç±»å’Œç»Ÿä¸€é”™è¯¯å¤„ç†
- åˆ†é˜¶æ®µè¿ç§»ç°æœ‰ä»£ç åˆ°æ–°æ¶æ„
- å»ºç«‹è‡ªåŠ¨åŒ–ä»£ç æ£€æŸ¥å’Œè§„èŒƒ

**é¢„æœŸæŠ•èµ„å›æŠ¥ï¼š**
- çŸ­æœŸï¼šå¼€å‘æ•ˆç‡æå‡30%ï¼Œé”™è¯¯å‡å°‘50%
- ä¸­æœŸï¼šç»´æŠ¤æˆæœ¬é™ä½40%ï¼Œæ–°äººåŸ¹è®­æ—¶é—´å‡å°‘70%
- é•¿æœŸï¼šç³»ç»Ÿç¨³å®šæ€§æ˜¾è‘—æå‡ï¼ŒæŠ€æœ¯å€ºåŠ¡å¾—åˆ°æ§åˆ¶

è¿™ä¸ªä¼˜åŒ–è®¡åˆ’è™½ç„¶éœ€è¦æŠ•å…¥è¾ƒå¤šèµ„æºï¼Œä½†å¯¹é¡¹ç›®çš„é•¿æœŸå‘å±•å’Œå›¢é˜Ÿæ•ˆç‡æå‡å…·æœ‰é‡è¦ä»·å€¼ã€‚å»ºè®®æŒ‰ç…§åˆ†é˜¶æ®µå®æ–½è®¡åˆ’ï¼Œç¡®ä¿ç¨³å®šè¿‡æ¸¡ã€‚